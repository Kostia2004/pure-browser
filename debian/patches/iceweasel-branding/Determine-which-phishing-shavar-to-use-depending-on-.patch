From: Mike Hommey <mh@glandium.org>
Date: Thu, 1 Apr 2010 15:34:59 +0200
Subject: Determine which phishing shavar to use depending on
 MOZ_OFFICIAL_BRANDING

---
 browser/app/Makefile.in                                |    4 ++++
 browser/app/profile/firefox.js                         |    4 ++++
 browser/components/safebrowsing/Makefile.in            |    4 ++++
 browser/components/safebrowsing/content/application.js |    4 ++++
 4 files changed, 16 insertions(+)

diff --git a/browser/app/Makefile.in b/browser/app/Makefile.in
index d16f456..109f242 100644
--- a/browser/app/Makefile.in
+++ b/browser/app/Makefile.in
@@ -163,6 +163,10 @@ endif # LIBXUL_SDK
 
 DEFINES += -DFIREFOX_ICO=\"$(DIST)/branding/firefox.ico\" -DDOCUMENT_ICO=\"$(DIST)/branding/document.ico\"
 
+ifdef MOZ_OFFICIAL_BRANDING
+DEFINES += -DMOZ_OFFICIAL_BRANDING
+endif
+
 ifeq ($(MOZ_WIDGET_TOOLKIT),gtk2)
 libs::
 	$(INSTALL) $(IFLAGS1) $(DIST)/branding/mozicon128.png $(DIST)/bin/icons
diff --git a/browser/app/profile/firefox.js b/browser/app/profile/firefox.js
index 0f78210..3d648dd 100644
--- a/browser/app/profile/firefox.js
+++ b/browser/app/profile/firefox.js
@@ -748,7 +748,11 @@ pref("urlclassifier.alternate_error_page", "blocked");
 pref("urlclassifier.gethashnoise", 4);
 
 // The list of tables that use the gethash request to confirm partial results.
+#ifdef MOZ_OFFICIAL_BRANDING
 pref("urlclassifier.gethashtables", "goog-phish-shavar,goog-malware-shavar");
+#else
+pref("urlclassifier.gethashtables", "googpub-phish-shavar,goog-malware-shavar");
+#endif
 
 // If an urlclassifier table has not been updated in this number of seconds,
 // a gethash request will be forced to check that the result is still in
diff --git a/browser/components/safebrowsing/Makefile.in b/browser/components/safebrowsing/Makefile.in
index 2d526c2..3b6ca17 100644
--- a/browser/components/safebrowsing/Makefile.in
+++ b/browser/components/safebrowsing/Makefile.in
@@ -51,6 +51,10 @@ ifdef MOZILLA_OFFICIAL
 DEFINES += -DOFFICIAL_BUILD=1
 endif
 
+ifdef MOZ_OFFICIAL_BRANDING
+DEFINES += -DMOZ_OFFICIAL_BRANDING
+endif
+
 EXTRA_COMPONENTS = \
   src/nsSafebrowsingApplication.manifest \
   $(NULL)
diff --git a/browser/components/safebrowsing/content/application.js b/browser/components/safebrowsing/content/application.js
index d353cbc..ec32c92 100644
--- a/browser/components/safebrowsing/content/application.js
+++ b/browser/components/safebrowsing/content/application.js
@@ -109,7 +109,11 @@ PROT_Application.prototype.initialize = function() {
   this.malwareWarden.maybeToggleUpdateChecking();
 
   this.phishWarden = new PROT_PhishingWarden();
+#ifdef MOZ_OFFICIAL_BRANDING
   this.phishWarden.registerBlackTable("goog-phish-shavar");
+#else
+  this.phishWarden.registerBlackTable("googpub-phish-shavar");
+#endif
   this.phishWarden.maybeToggleUpdateChecking();
 }
 
