From: Mike Hommey <mh@glandium.org>
Date: Thu, 28 Jan 2010 18:08:38 +0100
Subject: Install missing nanojit and .tbl headers from js/src

https://bugzilla.mozilla.org/show_bug.cgi?id=542789
---
 js/src/Makefile.in |   44 +++++++++++++++++++++++++++-----------------
 1 files changed, 27 insertions(+), 17 deletions(-)

diff --git a/js/src/Makefile.in b/js/src/Makefile.in
index b02e013..7566ef6 100644
--- a/js/src/Makefile.in
+++ b/js/src/Makefile.in
@@ -262,6 +262,7 @@ INSTALLED_HEADERS = \
 		jsval.h \
 		jsvalue.h \
 		prmjtime.h \
+		jskeyword.tbl \
 		$(NULL)
 
 ######################################################
@@ -306,21 +307,21 @@ VPATH		+= \
 
 INSTALLED_HEADERS += \
 		jsbuiltins.h    \
-		Assembler.h     \
-		Allocator.h     \
-		CodeAlloc.h     \
-		Containers.h    \
-		LIR.h		\
-		LIRopcode.tbl \
-		avmplus.h	\
-		Fragmento.h	\
-		Native.h	\
-		NativeCommon.h	\
-		Native$(NANOJIT_ARCH).h \
-		njconfig.h      \
-		njcpudetect.h   \
-		RegAlloc.h	\
-		nanojit.h	\
+		nanojit/Assembler.h     \
+		nanojit/Allocator.h     \
+		nanojit/CodeAlloc.h     \
+		nanojit/Containers.h    \
+		nanojit/LIR.h		\
+		nanojit/LIRopcode.tbl	\
+		nanojit/avmplus.h	\
+		nanojit/Fragmento.h	\
+		nanojit/Native.h	\
+		nanojit/NativeCommon.h	\
+		nanojit/Native$(NANOJIT_ARCH).h \
+		nanojit/njconfig.h	\
+		nanojit/njcpudetect.h	\
+		nanojit/RegAlloc.h	\
+		nanojit/nanojit.h	\
 		VMPI.h		\
 		Writer.h	\
 		$(NULL)
@@ -543,7 +544,11 @@ ifeq ($(OS_ARCH),WINNT)
 INSTALLED_HEADERS += jscpucfg.h
 endif
 
-EXPORTS = $(INSTALLED_HEADERS)
+EXPORTS = $(filter-out nanojit/%,$(INSTALLED_HEADERS))
+ifdef ENABLE_TRACEJIT
+EXPORTS_NAMESPACES += nanojit
+EXPORTS_nanojit = $(filter nanojit/%,$(INSTALLED_HEADERS))
+endif # ENABLE_TRACEJIT
 
 DASH_R		= -r
 
@@ -980,7 +985,12 @@ js-config: js-config.in Makefile $(DEPTH)/config/autoconf.mk $(topsrcdir)/config
 SCRIPTS = js-config
 SDK_BINARY = js-config
 
-install:: $(INSTALLED_HEADERS)
+ifdef ENABLE_TRACEJIT
+install:: $(filter nanojit/%,$(INSTALLED_HEADERS))
+	$(SYSINSTALL) $^ $(DESTDIR)$(includedir)/$(MODULE)/nanojit
+endif
+
+install:: $(filter-out nanojit/%,$(INSTALLED_HEADERS))
 	$(SYSINSTALL) $^ $(DESTDIR)$(includedir)/$(MODULE)
 
 install:: $(SCRIPTS)
