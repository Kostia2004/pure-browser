From: Mike Hommey <mh@glandium.org>
Date: Tue, 23 Mar 2010 17:04:10 +0100
Subject: Resolve GRE directory symbolic link

https://bugzilla.mozilla.org/show_bug.cgi?id=530196
https://bugzilla.mozilla.org/show_bug.cgi?id=550659
---
 xulrunner/stub/nsXULStub.cpp |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/xulrunner/stub/nsXULStub.cpp b/xulrunner/stub/nsXULStub.cpp
index 0437141..1b5ae8b 100644
--- a/xulrunner/stub/nsXULStub.cpp
+++ b/xulrunner/stub/nsXULStub.cpp
@@ -351,6 +351,15 @@ main(int argc, char **argv)
 
   greFound = FolderExists(greDir);
 
+#ifdef XP_UNIX
+  if (greFound) {
+    char resolved_greDir[MAXPATHLEN] = "";
+    if (realpath(greDir, resolved_greDir) && *resolved_greDir) {
+      strncpy(greDir, resolved_greDir, MAXPATHLEN);
+    }
+  }
+#endif
+
   strncpy(lastSlash, "application.ini", sizeof(iniPath) - (lastSlash - iniPath));
 
 #endif
