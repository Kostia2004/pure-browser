From 2b1cbc069b94e7f205f11cc4ed0b84c0a52493e0 Mon Sep 17 00:00:00 2001
From: Mike Hommey <mh@glandium.org>
Date: Thu, 2 Jul 2009 11:01:57 +0200
Subject: [PATCH 22/35] Avoid some symbols from being exported in C++ mangled form

---
 js/src/jscntxt.cpp                     |    2 +-
 js/src/jsobj.h                         |    5 +++++
 js/src/xpconnect/src/xpcquickstubs.cpp |    4 ----
 3 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/js/src/jscntxt.cpp b/js/src/jscntxt.cpp
index 2ca3e75..5213704 100644
--- a/js/src/jscntxt.cpp
+++ b/js/src/jscntxt.cpp
@@ -952,7 +952,7 @@ resolving_HashKey(JSDHashTable *table, const void *ptr)
     return ((JSDHashNumber)JS_PTR_TO_UINT32(key->obj) >> JSVAL_TAGBITS) ^ key->id;
 }
 
-JS_PUBLIC_API(JSBool)
+static JSBool
 resolving_MatchEntry(JSDHashTable *table,
                      const JSDHashEntryHdr *hdr,
                      const void *ptr)
diff --git a/js/src/jsobj.h b/js/src/jsobj.h
index 260bf28..12bb062 100644
--- a/js/src/jsobj.h
+++ b/js/src/jsobj.h
@@ -662,6 +662,11 @@ js_HasOwnProperty(JSContext *cx, JSLookupPropOp lookup, JSObject *obj, jsid id,
 extern JSBool
 js_PropertyIsEnumerable(JSContext *cx, JSObject *obj, jsid id, jsval *vp);
 
+#if JS_HAS_GETTER_SETTER
+JS_FRIEND_API(JSBool) js_obj_defineGetter(JSContext *cx, uintN argc, jsval *vp);
+JS_FRIEND_API(JSBool) js_obj_defineSetter(JSContext *cx, uintN argc, jsval *vp);
+#endif
+
 extern JSObject *
 js_InitEval(JSContext *cx, JSObject *obj);
 
diff --git a/js/src/xpconnect/src/xpcquickstubs.cpp b/js/src/xpconnect/src/xpcquickstubs.cpp
index b48df31..af2be5e 100644
--- a/js/src/xpconnect/src/xpcquickstubs.cpp
+++ b/js/src/xpconnect/src/xpcquickstubs.cpp
@@ -325,10 +325,6 @@ SharedLookupSetter(JSContext *cx, uintN argc, jsval *vp)
     return LookupGetterOrSetter(cx, PR_FALSE, vp);
 }
 
-// XXX Hack! :-/
-JS_FRIEND_API(JSBool) js_obj_defineGetter(JSContext *cx, uintN argc, jsval *vp);
-JS_FRIEND_API(JSBool) js_obj_defineSetter(JSContext *cx, uintN argc, jsval *vp);
-
 static JSBool
 DefineGetterOrSetter(JSContext *cx, uintN argc, JSBool wantGetter, jsval *vp)
 {
-- 
1.7.0.rc0.69.g2ee80

