From: Mike Hommey <mh@glandium.org>
Date: Sat, 26 Mar 2011 11:53:31 +0100
Subject: Avoid building arm neon code

https://bugzilla.mozilla.org/show_bug.cgi?id=547946
---
 configure.in          |    5 -----
 gfx/ycbcr/Makefile.in |    2 ++
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/configure.in b/configure.in
index 5987894..3f130ae 100644
--- a/configure.in
+++ b/configure.in
@@ -3678,10 +3678,6 @@ AC_SUBST(HAVE_ARM_SIMD)
 
 AC_MSG_CHECKING(for ARM NEON support in compiler)
 _SAVE_CFLAGS="$CFLAGS"
-if test "$GNU_CC"; then
-  # gcc needs -mfpu=neon to recognize NEON instructions
-  CFLAGS="$CFLAGS -mfpu=neon -mfloat-abi=softfp"
-fi
 # We try to link so that this also fails when
 # building with LTO.
 AC_TRY_LINK([],
@@ -3692,7 +3688,6 @@ if test "$result" = "yes"; then
     AC_DEFINE(HAVE_ARM_NEON)
     HAVE_ARM_NEON=1
 fi
-CFLAGS="$_SAVE_CFLAGS"
 AC_SUBST(HAVE_ARM_NEON)
 
 dnl ========================================================
diff --git a/gfx/ycbcr/Makefile.in b/gfx/ycbcr/Makefile.in
index 4e72694..6c6046b 100644
--- a/gfx/ycbcr/Makefile.in
+++ b/gfx/ycbcr/Makefile.in
@@ -75,9 +75,11 @@ endif # linux
 endif # windows
 
 ifeq (arm,$(findstring arm,$(OS_TEST)))
+ifdef HAVE_ARM_NEON
 CPPSRCS += yuv_convert_arm.cpp \
            $(NULL)
 endif
+endif
 
 EXTRA_DSO_LDOPTS += \
         $(LIBS_DIR) \
