From: Marco Bonardo <mbonardo@mozilla.com>
Date: Fri, 24 Jun 2011 18:00:07 +0200
Subject: Bug 666709 - One or more places xpcshell tests modify in-tree
 default.sqlite.

---
 .../tests/unit/test_database_replaceOnStartup.js   |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/toolkit/components/places/tests/unit/test_database_replaceOnStartup.js b/toolkit/components/places/tests/unit/test_database_replaceOnStartup.js
index d55e593..1f3a95d 100644
--- a/toolkit/components/places/tests/unit/test_database_replaceOnStartup.js
+++ b/toolkit/components/places/tests/unit/test_database_replaceOnStartup.js
@@ -16,7 +16,8 @@ function run_test() {
   }
 
   let file = do_get_file("default.sqlite");
-  file.copyTo(gProfD, "places.sqlite");
+  file.copyToFollowingLinks(gProfD, "places.sqlite");
+  file = gProfD.clone().append("places.sqlite");
 
   // Create some unique stuff to check later.
   let db = Services.storage.openUnsharedDatabase(file);
