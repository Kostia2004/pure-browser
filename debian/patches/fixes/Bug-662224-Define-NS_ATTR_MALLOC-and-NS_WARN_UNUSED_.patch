From: Mike Hommey <mh@glandium.org>
Date: Mon, 6 Jun 2011 07:09:13 +0200
Subject: Bug 662224 - Define NS_ATTR_MALLOC and NS_WARN_UNUSED_RESULT in
 xpcom-config.h, and include it from mozalloc.h

---
 memory/mozalloc/Makefile.in |    2 ++
 memory/mozalloc/mozalloc.h  |    2 +-
 xpcom/xpcom-config.h.in     |    6 ++++++
 3 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/memory/mozalloc/Makefile.in b/memory/mozalloc/Makefile.in
index 2cfd6ee..ecb9a42 100644
--- a/memory/mozalloc/Makefile.in
+++ b/memory/mozalloc/Makefile.in
@@ -120,4 +120,6 @@ else
 SDK_LIBRARY = $(SHARED_LIBRARY)
 endif
 
+LOCAL_INCLUDES += -I$(DEPTH)/xpcom
+
 include $(topsrcdir)/config/rules.mk
diff --git a/memory/mozalloc/mozalloc.h b/memory/mozalloc/mozalloc.h
index 745330b..f8fc5e5 100644
--- a/memory/mozalloc/mozalloc.h
+++ b/memory/mozalloc/mozalloc.h
@@ -50,7 +50,7 @@
 #if defined(__cplusplus)
 #  include <new>
 #endif
-
+#include "xpcom-config.h"
 
 #define MOZALLOC_HAVE_XMALLOC
 
diff --git a/xpcom/xpcom-config.h.in b/xpcom/xpcom-config.h.in
index 17afa70..9bba9dd 100644
--- a/xpcom/xpcom-config.h.in
+++ b/xpcom/xpcom-config.h.in
@@ -65,4 +65,10 @@
 /* Define to either <new> or <new.h> */
 #undef NEW_H
 
+/* Define to either __attribute__((malloc)) or nothing */
+#undef NS_ATTR_MALLOC
+
+/* Define to either __attribute__((warn_unused_result)) or nothing */
+#undef NS_WARN_UNUSED_RESULT
+
 #endif /* _XPCOM_CONFIG_H_ */
