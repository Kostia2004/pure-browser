From: Mike Hommey <mh@glandium.org>
Date: Fri, 30 Nov 2012 11:31:46 +0100
Subject: Bug 815320 - Fix services import urls

---
 services/common/bagheeraclient.js                                |    6 +++---
 services/common/modules-testing/bagheeraserver.js                |    4 ++--
 services/healthreport/HealthReportComponents.manifest            |    4 ++--
 services/healthreport/HealthReportService.js                     |    2 +-
 services/healthreport/healthreporter.jsm                         |    4 ++--
 services/healthreport/policy.jsm                                 |    4 ++--
 services/healthreport/providers.jsm                              |    2 +-
 services/healthreport/tests/xpcshell/test_healthreporter.js      |    4 ++--
 services/healthreport/tests/xpcshell/test_load_modules.js        |    2 +-
 services/healthreport/tests/xpcshell/test_policy.js              |    2 +-
 services/healthreport/tests/xpcshell/test_provider_appinfo.js    |    4 ++--
 services/healthreport/tests/xpcshell/test_provider_sysinfo.js    |    4 ++--
 services/metrics/collector.jsm                                   |    2 +-
 services/metrics/modules-testing/mocks.jsm                       |    2 +-
 services/metrics/tests/xpcshell/test_load_modules.js             |    2 +-
 .../metrics/tests/xpcshell/test_metrics_collection_result.js     |    2 +-
 services/metrics/tests/xpcshell/test_metrics_collector.js        |    4 ++--
 services/metrics/tests/xpcshell/test_metrics_provider.js         |    2 +-
 testing/marionette/components/marionettecomponent.js             |    2 +-
 testing/marionette/marionette-actors.js                          |    2 +-
 20 files changed, 30 insertions(+), 30 deletions(-)

diff --git a/services/common/bagheeraclient.js b/services/common/bagheeraclient.js
index 5944665..4193cfb 100644
--- a/services/common/bagheeraclient.js
+++ b/services/common/bagheeraclient.js
@@ -19,9 +19,9 @@ this.EXPORTED_SYMBOLS = [
 const {classes: Cc, interfaces: Ci, utils: Cu} = Components;
 
 Cu.import("resource://gre/modules/commonjs/promise/core.js");
-Cu.import("resource://gre/modules/services-common/log4moz.js");
-Cu.import("resource://gre/modules/services-common/rest.js");
-Cu.import("resource://gre/modules/services-common/utils.js");
+Cu.import("resource://services-common/log4moz.js");
+Cu.import("resource://services-common/rest.js");
+Cu.import("resource://services-common/utils.js");
 
 
 /**
diff --git a/services/common/modules-testing/bagheeraserver.js b/services/common/modules-testing/bagheeraserver.js
index a8756a4..c6a3e7c 100644
--- a/services/common/modules-testing/bagheeraserver.js
+++ b/services/common/modules-testing/bagheeraserver.js
@@ -8,8 +8,8 @@ const {utils: Cu} = Components;
 
 this.EXPORTED_SYMBOLS = ["BagheeraServer"];
 
-Cu.import("resource://gre/modules/services-common/log4moz.js");
-Cu.import("resource://gre/modules/services-common/utils.js");
+Cu.import("resource://services-common/log4moz.js");
+Cu.import("resource://services-common/utils.js");
 Cu.import("resource://testing-common/httpd.js");
 
 
diff --git a/services/healthreport/HealthReportComponents.manifest b/services/healthreport/HealthReportComponents.manifest
index 1157c14..4ce401e 100644
--- a/services/healthreport/HealthReportComponents.manifest
+++ b/services/healthreport/HealthReportComponents.manifest
@@ -9,6 +9,6 @@ component {e354c59b-b252-4040-b6dd-b71864e3e35c} HealthReportService.js
 contract @mozilla.org/healthreport/service;1 {e354c59b-b252-4040-b6dd-b71864e3e35c}
 category app-startup HealthReportService service,@mozilla.org/healthreport/service;1 application={3c2e2abc-06d4-11e1-ac3b-374f68613e61} application={ec8030f7-c20a-464f-9b0e-13a3a9e97384} application={aa3c5121-dab2-40e2-81ca-7ea25febc110} application={a23983c0-fd0e-11dc-95ff-0800200c9a66}
 
-category healthreport-js-provider AppInfoProvider resource://gre/modules/services/healthreport/providers.jsm
-category healthreport-js-provider SysInfoProvider resource://gre/modules/services/healthreport/providers.jsm
+category healthreport-js-provider AppInfoProvider resource:///modules/services/healthreport/providers.jsm
+category healthreport-js-provider SysInfoProvider resource:///modules/services/healthreport/providers.jsm
 
diff --git a/services/healthreport/HealthReportService.js b/services/healthreport/HealthReportService.js
index 1d8eba9..efe991e 100644
--- a/services/healthreport/HealthReportService.js
+++ b/services/healthreport/HealthReportService.js
@@ -95,7 +95,7 @@ HealthReportService.prototype = {
     // Lazy import so application startup isn't adversely affected.
     let ns = {};
     Cu.import("resource://services-common/log4moz.js", ns);
-    Cu.import("resource://gre/modules/services/healthreport/healthreporter.jsm", ns);
+    Cu.import("resource:///modules/services/healthreport/healthreporter.jsm", ns);
 
     // How many times will we rewrite this code before rolling it up into a
     // generic module? See also bug 451283.
diff --git a/services/healthreport/healthreporter.jsm b/services/healthreport/healthreporter.jsm
index 0e6f372..b1a201e 100644
--- a/services/healthreport/healthreporter.jsm
+++ b/services/healthreport/healthreporter.jsm
@@ -15,8 +15,8 @@ Cu.import("resource://services-common/preferences.js");
 Cu.import("resource://services-common/utils.js");
 Cu.import("resource://gre/modules/commonjs/promise/core.js");
 Cu.import("resource://gre/modules/osfile.jsm");
-Cu.import("resource://gre/modules/services/healthreport/policy.jsm");
-Cu.import("resource://gre/modules/services/metrics/collector.jsm");
+Cu.import("resource:///modules/services/healthreport/policy.jsm");
+Cu.import("resource:///modules/services/metrics/collector.jsm");
 
 
 // Oldest year to allow in date preferences. This module was implemented in
diff --git a/services/healthreport/policy.jsm b/services/healthreport/policy.jsm
index 900f9a5..d26470f 100644
--- a/services/healthreport/policy.jsm
+++ b/services/healthreport/policy.jsm
@@ -12,8 +12,8 @@ this.EXPORTED_SYMBOLS = [
 const {classes: Cc, interfaces: Ci, utils: Cu} = Components;
 
 Cu.import("resource://gre/modules/commonjs/promise/core.js");
-Cu.import("resource://gre/modules/services-common/log4moz.js");
-Cu.import("resource://gre/modules/services-common/utils.js");
+Cu.import("resource://services-common/log4moz.js");
+Cu.import("resource://services-common/utils.js");
 
 const MILLISECONDS_PER_DAY = 24 * 60 * 60 * 1000;
 
diff --git a/services/healthreport/providers.jsm b/services/healthreport/providers.jsm
index ea22254..40dc41a 100644
--- a/services/healthreport/providers.jsm
+++ b/services/healthreport/providers.jsm
@@ -23,7 +23,7 @@ const {classes: Cc, interfaces: Ci, utils: Cu} = Components;
 
 Cu.import("resource://gre/modules/Services.jsm");
 Cu.import("resource://gre/modules/XPCOMUtils.jsm");
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 Cu.import("resource://services-common/preferences.js");
 Cu.import("resource://services-common/utils.js");
 
diff --git a/services/healthreport/tests/xpcshell/test_healthreporter.js b/services/healthreport/tests/xpcshell/test_healthreporter.js
index 3ba8650..2844ec1 100644
--- a/services/healthreport/tests/xpcshell/test_healthreporter.js
+++ b/services/healthreport/tests/xpcshell/test_healthreporter.js
@@ -8,8 +8,8 @@ const {classes: Cc, interfaces: Ci, utils: Cu} = Components;
 Cu.import("resource://services-common/observers.js");
 Cu.import("resource://services-common/preferences.js");
 Cu.import("resource://gre/modules/commonjs/promise/core.js");
-Cu.import("resource://gre/modules/services/healthreport/healthreporter.jsm");
-Cu.import("resource://gre/modules/services/healthreport/policy.jsm");
+Cu.import("resource:///modules/services/healthreport/healthreporter.jsm");
+Cu.import("resource:///modules/services/healthreport/policy.jsm");
 Cu.import("resource://testing-common/services-common/bagheeraserver.js");
 Cu.import("resource://testing-common/services/metrics/mocks.jsm");
 
diff --git a/services/healthreport/tests/xpcshell/test_load_modules.js b/services/healthreport/tests/xpcshell/test_load_modules.js
index d41ef5b..dc54b17 100644
--- a/services/healthreport/tests/xpcshell/test_load_modules.js
+++ b/services/healthreport/tests/xpcshell/test_load_modules.js
@@ -15,7 +15,7 @@ const test_modules = [
 
 function run_test() {
   for (let m of modules) {
-    let resource = "resource://gre/modules/services/healthreport/" + m;
+    let resource = "resource:///modules/services/healthreport/" + m;
     Components.utils.import(resource, {});
   }
 
diff --git a/services/healthreport/tests/xpcshell/test_policy.js b/services/healthreport/tests/xpcshell/test_policy.js
index c0c6a56..dc57839 100644
--- a/services/healthreport/tests/xpcshell/test_policy.js
+++ b/services/healthreport/tests/xpcshell/test_policy.js
@@ -6,7 +6,7 @@
 const {utils: Cu} = Components;
 
 Cu.import("resource://services-common/preferences.js");
-Cu.import("resource://gre/modules/services/healthreport/policy.jsm");
+Cu.import("resource:///modules/services/healthreport/policy.jsm");
 Cu.import("resource://testing-common/services/healthreport/mocks.jsm");
 
 
diff --git a/services/healthreport/tests/xpcshell/test_provider_appinfo.js b/services/healthreport/tests/xpcshell/test_provider_appinfo.js
index b74553f..6c03e69 100644
--- a/services/healthreport/tests/xpcshell/test_provider_appinfo.js
+++ b/services/healthreport/tests/xpcshell/test_provider_appinfo.js
@@ -6,8 +6,8 @@
 const {interfaces: Ci, results: Cr, utils: Cu} = Components;
 
 Cu.import("resource://gre/modules/XPCOMUtils.jsm");
-Cu.import("resource://gre/modules/services/healthreport/providers.jsm");
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/healthreport/providers.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 
 function run_test() {
   let appInfo = {
diff --git a/services/healthreport/tests/xpcshell/test_provider_sysinfo.js b/services/healthreport/tests/xpcshell/test_provider_sysinfo.js
index 7fd82b0..b0f4e1c 100644
--- a/services/healthreport/tests/xpcshell/test_provider_sysinfo.js
+++ b/services/healthreport/tests/xpcshell/test_provider_sysinfo.js
@@ -6,8 +6,8 @@
 const {interfaces: Ci, results: Cr, utils: Cu} = Components;
 
 Cu.import("resource://gre/modules/XPCOMUtils.jsm");
-Cu.import("resource://gre/modules/services/healthreport/providers.jsm");
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/healthreport/providers.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 
 
 function run_test() {
diff --git a/services/metrics/collector.jsm b/services/metrics/collector.jsm
index aedeb15..d6c0312 100644
--- a/services/metrics/collector.jsm
+++ b/services/metrics/collector.jsm
@@ -11,7 +11,7 @@ const {utils: Cu} = Components;
 Cu.import("resource://gre/modules/commonjs/promise/core.js");
 Cu.import("resource://services-common/log4moz.js");
 Cu.import("resource://services-common/utils.js");
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 
 
 /**
diff --git a/services/metrics/modules-testing/mocks.jsm b/services/metrics/modules-testing/mocks.jsm
index 9f65d4e..90de84c 100644
--- a/services/metrics/modules-testing/mocks.jsm
+++ b/services/metrics/modules-testing/mocks.jsm
@@ -11,7 +11,7 @@ this.EXPORTED_SYMBOLS = [
 
 const {utils: Cu} = Components;
 
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 
 this.DummyMeasurement = function DummyMeasurement(name="DummyMeasurement") {
   MetricsMeasurement.call(this, name, 2);
diff --git a/services/metrics/tests/xpcshell/test_load_modules.js b/services/metrics/tests/xpcshell/test_load_modules.js
index e597a92..41e1eda 100644
--- a/services/metrics/tests/xpcshell/test_load_modules.js
+++ b/services/metrics/tests/xpcshell/test_load_modules.js
@@ -14,7 +14,7 @@ const test_modules = [
 
 function run_test() {
   for (let m of modules) {
-    let resource = "resource://gre/modules/services/metrics/" + m;
+    let resource = "resource:///modules/services/metrics/" + m;
     Components.utils.import(resource, {});
   }
 
diff --git a/services/metrics/tests/xpcshell/test_metrics_collection_result.js b/services/metrics/tests/xpcshell/test_metrics_collection_result.js
index 5cfd182..26024a5 100644
--- a/services/metrics/tests/xpcshell/test_metrics_collection_result.js
+++ b/services/metrics/tests/xpcshell/test_metrics_collection_result.js
@@ -5,7 +5,7 @@
 
 const {utils: Cu} = Components;
 
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 Cu.import("resource://testing-common/services/metrics/mocks.jsm");
 
 
diff --git a/services/metrics/tests/xpcshell/test_metrics_collector.js b/services/metrics/tests/xpcshell/test_metrics_collector.js
index 8851288..b8f8448 100644
--- a/services/metrics/tests/xpcshell/test_metrics_collector.js
+++ b/services/metrics/tests/xpcshell/test_metrics_collector.js
@@ -5,8 +5,8 @@
 
 const {utils: Cu} = Components;
 
-Cu.import("resource://gre/modules/services/metrics/collector.jsm");
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/metrics/collector.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 Cu.import("resource://testing-common/services/metrics/mocks.jsm");
 
 
diff --git a/services/metrics/tests/xpcshell/test_metrics_provider.js b/services/metrics/tests/xpcshell/test_metrics_provider.js
index 2a969ae..75d0e5f 100644
--- a/services/metrics/tests/xpcshell/test_metrics_provider.js
+++ b/services/metrics/tests/xpcshell/test_metrics_provider.js
@@ -5,7 +5,7 @@
 
 const {utils: Cu} = Components;
 
-Cu.import("resource://gre/modules/services/metrics/dataprovider.jsm");
+Cu.import("resource:///modules/services/metrics/dataprovider.jsm");
 Cu.import("resource://testing-common/services/metrics/mocks.jsm");
 
 
diff --git a/testing/marionette/components/marionettecomponent.js b/testing/marionette/components/marionettecomponent.js
index 6246f82..e63739a 100644
--- a/testing/marionette/components/marionettecomponent.js
+++ b/testing/marionette/components/marionettecomponent.js
@@ -18,7 +18,7 @@ const ServerSocket = CC("@mozilla.org/network/server-socket;1",
 Cu.import("resource://gre/modules/XPCOMUtils.jsm");
 Cu.import("resource://gre/modules/Services.jsm");
 Cu.import("resource://gre/modules/FileUtils.jsm");
-Cu.import("resource:///modules/services-common/log4moz.js");
+Cu.import("resource://services-common/log4moz.js");
 
 function MarionetteComponent() {
   this._loaded = false;
diff --git a/testing/marionette/marionette-actors.js b/testing/marionette/marionette-actors.js
index f05e79f..6c6b2ca 100644
--- a/testing/marionette/marionette-actors.js
+++ b/testing/marionette/marionette-actors.js
@@ -37,7 +37,7 @@ Services.prefs.setBoolPref("marionette.contentListener", false);
 let appName = Services.appinfo.name;
 
 // import logger
-Cu.import("resource:///modules/services-common/log4moz.js");
+Cu.import("resource://services-common/log4moz.js");
 let logger = Log4Moz.repository.getLogger("Marionette");
 logger.info('marionette-actors.js loaded');
 
