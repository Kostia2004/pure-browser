From: Justin Lebar <justin.lebar@gmail.com>
Date: Wed, 16 Jan 2013 01:27:05 +0100
Subject: Bug 821502 - Disable -fstrict-aliasing in JS for GCC 4.4 and earlier
 on Linux and Android. r=glandium,terrence; a=bajaj

---
 js/src/configure.in |   20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/js/src/configure.in b/js/src/configure.in
index 499154c..1c97fe9 100644
--- a/js/src/configure.in
+++ b/js/src/configure.in
@@ -4978,6 +4978,26 @@ AC_SUBST(CXX_WRAPPER)
 
 
 dnl ========================================================
+dnl = Disable -fstrict-aliasing on Linux/Android with GCC 4.4 and earlier.
+dnl = See bug 821502.
+dnl ========================================================
+if test "$GNU_CC"; then
+    changequote(,)
+    GCC_VERSION_FULL=`echo "$CXX_VERSION" | $PERL -pe 's/^.*gcc version ([^ ]*).*/$1/'`
+    GCC_VERSION=`echo "$GCC_VERSION_FULL" | $PERL -pe '(split(/\./))[0]>=4&&s/(^\d*\.\d*).*/$1/;'`
+    changequote([,])
+
+    GCC_MAJOR_VERSION=`echo ${GCC_VERSION} | $AWK -F\. '{ print $1 }'`
+    GCC_MINOR_VERSION=`echo ${GCC_VERSION} | $AWK -F\. '{ print $2 }'`
+
+    dnl GCC 3.x isn't supported, so we don't need to check for that.
+    if test "$GCC_MAJOR_VERSION" -eq "4" -a "$GCC_MINOR_VERSION" -lt "5" ; then
+        CFLAGS="$CFLAGS -fno-strict-aliasing"
+        CXXFLAGS="$CXXFLAGS -fno-strict-aliasing"
+    fi
+fi
+
+dnl ========================================================
 dnl = Link js shell to system readline
 dnl ========================================================
 MOZ_ARG_ENABLE_BOOL(readline,
